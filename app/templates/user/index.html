{% extends "base.html" %}
{% from "_macro.html" import goods_li_show, navbar %}

{# 设置footer置底的关键代码 #}
{% block html_tag %}class="h-100"{% endblock %}
{% block body_tag %}class="d-flex flex-column h-100"{% endblock %}

{% block body %}
    <main role="main" class="flex-shrink-0">

    <!-- 头部 -->
    {% include 'user/_head.html' %}

    <!-- 标头caption部分 -->
    <div class="container mt-3">
        <div {% if user_obj.id == current_user.id %} onclick="bgChange('{{ url_for('.bg_change') }}')" {% endif %}
             class="row rounded mx-0"
             style="height: 10rem;
                     background: url('{{ url_for('static', filename='img_bg/'+user_obj.bg_image) }}') no-repeat center;
                     background-size: cover;">
            <div class="h-100 w-100 rounded" style="background: rgba(0,0,0,0.4);">
                <div class="row h-100 align-items-center text-white">
                    <div class="col m-2">
                        <p class="h4">
                            {% if user_obj.resume %}{{ user_obj.resume }}{% else %}{% if user_obj.id == current_user.id %}这里是您的个人空间，可在账号编辑处修改此处展示的文字内容哟.{% else %}还没有编辑个人介绍哟...{% endif %}{% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 导航条 start -->
    {{ navbar(uid=user_obj.id, TYPE_LI=TYPE_LI) }}

    <!-- 商品展示部分 start -->
    {% for one in goods_data %}
    <div class="container">
    <div class="row">
        <div class="col-12">
            <div class="font-weight-bolder">
                <span>{{ one['name'] }}</span>
                <a href="{{ one['href'] }}" class="float-right text-warning"><i class="fas fa-angle-double-right"></i></a>
            </div>
            <hr class="bg-warning border-0 mt-1" style="height: 0.1rem;">
        </div>
    </div>
    </div>
    {{ goods_li_show(goods_li=one['data']) }}
    {% endfor %}

    <div class="pb-5"></div>  <!-- 撑底部高度 -->

    </main>

    <!-- footer部分 -->
    {% include "_footer.html" %}

{% endblock %}

{% block script %}
    <script type="text/javascript">

        // 个人背景图更换入口
        function bgChange(url) {
            showMsg(
                '<button id="bg-change-btn" class="btn btn-info">更换背景图</button>' +
                '<div id="dropzone">\n' +
                '        <div id="previewTemplate" style="display: none;">\n' +
                '          <div class="dz-preview">\n' +
                '            <small class="mr-4" data-dz-name></small><small data-dz-size></small>\n' +
                '            <div class="progress mb-3">\n' +
                '              <div class="progress-bar progress-bar-striped bg-warning progress-bar-animated" role="progressbar" style="width: 0;" aria-valuemin="0" aria-valuemax="100" data-dz-uploadprogress></div>\n' +
                '            </div>\n' +
                '          </div>\n' +
                '        </div>\n' +
                '    </div>'
            );

            // 更换背景图的图片上传接口
            $('#dropzone').dropzone({
                url: url,
                previewTemplate: $('#previewTemplate').html(),
                clickable: '#bg-change-btn',
                acceptedFiles: 'image/*',
                maxFiles: 1,
                parallelUploads: 1,
                init: function () {
                    this.on('success', function (file) {
                        // this.removeFile(file);
                        location.reload();
                    });
                    this.on('error', function (file) {
                        this.removeFile(file);
                        $("#bg-change-btn").text('上传失败，点击重试')
                    })
                }
            });
        }
    </script>
{% endblock %}